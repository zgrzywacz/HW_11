
---
title: "HW_11"
author: "Caleb Malay and Zack Grzywacz"
date: "11/22/2019"
output: html_document
---

Caleb and Zack

**1) Using the R data Titanic, use apply to answer the following:** 

#First gain access to the Titanic data.
```{r}
data("Titanic")
```
+ Were rates of survival higher among children or adults? 

#In this command, we take the dataset "Titanic", combine the Age and Survival Rate values, and get the sum.
```{r}
apply(Titanic, c(3,4), sum)
```
#As we can see, children had a higher survival rate than adults. 

+ Were rates of survival higher among men or women?  

#This command takes the dataset "Titanic", combines the Sex and Survival Rate values, and gets
the sum.

```{r}
apply(Titanic, c(2,4), sum)
```
#As we can see, women had a higher survival rate than men. 

#### lapply
**2) Some insect species can only survive if daily temperatures stay above some temperature.  Write a function that takes two arguments, a data frame and a temperature that returns a TRUE when the tmin > X and a FALSE when tmin is < X, where X is the threshold temperature.  Have the function then add a logical vector to each daily climate data frame reporting whether that threshold was exceeded (TRUE) or not (FALSE). Apply this function across all three of the daily data frames provided in /data. For each data frame, your results might look like:**

#Loads in files and formats them in a readable dataframe. 
```{r}
data.path <- "./data/"
glob.path <- paste0(data.path, "*", ".csv")
dataFiles <- lapply(Sys.glob(glob.path), read.csv, skip=11, head=F)
 climvars <- c("pdate", "ppt", "tmin", "tmean", "tmax")
 dataFiles <- lapply(dataFiles, setNames, climvars)
 head(dataFiles[[1]])
```

#Function that returns a True when tmin is greater than the threshold and False when tmin is less than the threshold.
```{r}
threshold <- function(dataset, temp){
  dataset$threshold <- (dataset[,3] > temp)
  return(dataset)
}
```

```{r}
lapply(dataFiles, threshold, -3)
```


**3) Write a loop to extract Cape Grim monthly temperature data (GHCN) for 1985-2019 using rnoaa.**

```{r}
library(rnoaa)
```

```{r}
datalist <- vector(mode="list",length=1)
for (year in 1985:2019){
  startyr <- paste0(year,'-01-01')
  endyr <- paste0(year,'-12-01')
  tempdata <- ncdc(datasetid='GSOM', stationid = 'GHCND:ASN00091245', datatypeid='TAVG', startdate = startyr, enddate = endyr, limit = 100, includemetadata = FALSE)
datalist <- append(datalist, tempdata)
}
```
All Cape Grim temperature files are now in datalist.


**4) Calculate the average annual temperature and the number of months used to generate that mean from #3 above (years without data can be excluded).  Report in a table, for example:**

To separate the data files from the metadata files, we will grep from the datalist.

```{r}
justdata <- datalist[grepl("data", names(datalist))]
```
This data can be sent through a loop to collect the yearly average temperature data

```{r}
tempsum <- setNames(data.frame(matrix(ncol = 3, nrow = 35)), c("Year", "Tavg", "Mons"))
rowsToDelete <- c()
for(x in 1:35){
  currentdata <- data.frame(justdata[x])
  if(nrow(currentdata) >= 1){
    tempsum[x,1] <- (1984 + x)
    tempsum[x,2] <- (colSums(currentdata[4])/nrow(currentdata))
    tempsum[x,3] <- nrow(currentdata)
  }
  
tempsum <- na.omit(tempsum)
return(tempsum)
}
```


Your solution is great, but it's pretty dependent on the dates selected.  If dates change, then you would need to update your code in multiple places...my solution:
```{r}
Grim_T <- list()

for (year in seq(1985, 2019)){
  stDate <- paste0(year, "-01-01")
  endDate <- paste0(year, "-12-31")
 Tdat <- ncdc(datasetid='GSOM', stationid = 'GHCND:ASN00091245', datatypeid='TAVG', startdate = stDate, enddate = endDate, limit = 100, add_units=TRUE)
 name <- paste0("GrimT_", year)
  Grim_T[[name]] <- Tdat[[2]]
}

```

4) Calculate the average annual temperature and the number of months used to generate that mean (years without data can be excluded).  Report in a table.

```{r, echo=FALSE}
test2 <- bind_rows(Grim_T) #requires dplyr
#or
test2 <- do.call(rbind, Grim_T)
```

Calculate the mean T for each year
```{r}
test2$year <- year(test2$date)
year_mn <- aggregate(value ~ year, data=test2, FUN = "mean")
count <- aggregate(value ~ year, data=test2, FUN = length)
CapeG_Tavg <- data.frame("Year" = year_mn$year, "Tavg" = year_mn$value, "Mons" = count$value)
CapeG_Tavg_tbl <- head(CapeG_Tavg, 3)
CapeG_Tavg_tbl %>%
  kable() %>%
  kable_styling()
```
